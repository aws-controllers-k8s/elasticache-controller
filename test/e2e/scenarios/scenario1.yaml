id: "RG_CMD_basic_create_update"
description: "In this test we create RG with absolutely minimum configuration and try to update it."
usecases:
  - replication_group
  - cmd
#marks:
#  - slow
#  - blocked
steps:
  - id: "create_CMD_replication_group"
    description: "Initial config"
    create:
      apiVersion: $CRD_GROUP/$CRD_VERSION
      kind: ReplicationGroup
      metadata:
        name: test$RANDOM_SUFFIX
      spec:
        engine: redis
        replicationGroupID: test$RANDOM_SUFFIX
        replicationGroupDescription: Basic create and update of CMD RG
        cacheNodeType: cache.t3.micro
        numNodeGroups: 1
    expect:
      status:
        conditions:
          ACK.ResourceSynced: "True"
        status: "available"
  - id: "invalid_cacheNodeType_on_CMD_replication_group_causes_Terminal_condition"
    description: "Negative test include transitEncryptionEnabled"
    patch:
      apiVersion: $CRD_GROUP/$CRD_VERSION
      kind: ReplicationGroup
      metadata:
        name: test$RANDOM_SUFFIX
      spec:
        cacheNodeType: cache.micro # invalid value
    expect:
      status:
        conditions:
          ACK.Terminal: "True"
  - id: "delete_CMD_RG"
    description: "Delete cluster mode disabled replication group"
    delete:
      apiVersion: $CRD_GROUP/$CRD_VERSION
      kind: ReplicationGroup
      metadata:
        name: test$RANDOM_SUFFIX
